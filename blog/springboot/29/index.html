<!doctype html><html lang=zh-tw><head><meta charset=utf-8><title>Spring Boot 零基礎入門 (29) - 實戰演練 - 打造一個簡單的圖書館系統
</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="實際使用 Spring Boot 練習打造一個簡易的圖書館系統"><meta name=author content="古古"><meta property="og:image" content="https://kucw.io/images/logo.png"><meta name=generator content="Hugo 0.145.0 with theme pure"><link rel=stylesheet href=https://kucw.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://kucw.io/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://kucw.io/plugins/venobox/venobox.css><link rel=stylesheet href=https://kucw.io/plugins/medium-zoom/medium-zoom.css><link rel=stylesheet href=https://kucw.io/scss/style.min.d0dbde05028230889123aec57bd4277b184ffb8ec8b13e1dae16f3946be51984.css media=screen><link rel="shortcut icon" href=https://kucw.io/images/favicon.png type=image/x-icon><link rel=icon href=https://kucw.io/images/favicon.png type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-FDFT2W6V4S"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-NKQ46H0SJW")</script><script src=https://kucw.io/js/google-firebase-login.min.69fad9ce5fc6ddb2a672d6f8497b357c0eb6b5ff30ceea1601cdd8f2b936213b.js type=module></script></head><body><div class=preloader></div><header class=navigation><div class="container-fluid border-bottom fixed-top nav-background-color"><div class=nav-container><nav class="navbar navbar-expand-lg navbar-white bg-transparent px-0"><a class="navbar-brand desktop-view" href=https://kucw.io/><img class="img-fluid logo-with-text-size mx-1" src=https://kucw.io/images/logo-with-text-transparent.png alt>
</a><a class="navbar-brand navbar-brand-mobile mobile-view" href=https://kucw.io/><img class="img-fluid logo-thumb-sm rounded-circle" src=https://kucw.io/images/logo.png alt>
</a><button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav mr-auto ml-2"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>後端技術專欄</a><div class=dropdown-menu><a class=dropdown-item href=https://kucw.io/blog/springboot/1>Spring Boot 零基礎入門</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>線上課程</a><div class=dropdown-menu><a class=dropdown-item href=https://hahow.in/cr/kucw-github-hugo target=_blank rel=noopener>GitHub 免費架站術！輕鬆打造個人品牌</a>
<a class=dropdown-item href=https://hahow.in/cr/springboot target=_blank rel=noopener>Java 工程師必備！Spring Boot 零基礎入門</a>
<a class=dropdown-item href=https://hahow.in/cr/springsecurity target=_blank rel=noopener>資安一把罩！Spring Security 零基礎入門</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>自媒體 & 敗家專區</a><div class=dropdown-menu><a class=dropdown-item href=https://kucw.io/blog/as-a-content-creator/1>軟體工程師的自媒體之路</a></div></li><li class=nav-item><a class=nav-link href=https://kucw.io/>所有文章</a></li><li class=nav-item><a class=nav-link href=https://kucw.io/about>關於我</a></li><li class=nav-item><button id=algolia-search-btn class=algolia-search-btn><i class=ti-search></i></button></li></ul><ul class=navbar-nav><a class=nav-newsletter-link href=/bio target=_blank>電子報訂閱</a></ul></div></nav></div></div></header><div id=algolia-search-pop-overlay class=algolia-search-pop-overlay><div class="popup algolia-search-popup"><div class=algolia-search-header><span class=algolia-search-icon><i class=ti-search></i></span><div id=algolia-search-input-container class=algolia-search-input-container></div><span id=algolia-popup-btn-close class=algolia-popup-btn-close><i class=ti-close></i></span></div><div id=algolia-results class=algolia-results><div id=algolia-hits class=algolia-hits></div><div id=algolia-pagination class=algolia-pagination></div></div></div></div><div id=login-pop-overlay class=login-pop-overlay><div class="popup login-popup"><div class=login-popup-header><img class="img-fluid logo-with-text-size mx-1" src=https://kucw.io/images/logo-with-text-transparent.png alt><div id=login-popup-btn-close class=login-popup-btn-close><i class=ti-close></i></div></div><div class=login-popup-body><button class=google-login-btn id=google-login-btn>
<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.6 10.2c0-.7.0-1.4-.2-2H10V12h5.4c-.3 1.3-1 2.4-2 3v2.6h3.2c2-1.8 3-4.3 3-7.4z" fill="#4285f4"/><path fill-rule="evenodd" clip-rule="evenodd" d="M10 20c2.7.0 5-.9 6.6-2.4L13.4 15a6 6 0 01-9-3.2H1.1v2.6A10 10 0 0010 20z" fill="#34a853"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.4 11.9a6 6 0 010-3.8V5.5H1.1a10 10 0 000 9l3.3-2.6z" fill="#fbbc05"/><path fill-rule="evenodd" clip-rule="evenodd" d="M10 4c1.5.0 2.8.5 3.8 1.5l2.9-2.9A10 10 0 001 5.5l3.3 2.6A6 6 0 0110 4z" fill="#ea4335"/></svg>
<span class=google-login-btn-text>使用 Google 登入</span></button><p class=login-terms>By signing in, you agree to 古古的後端筆記's terms of service and privacy policy.</p></div></div></div><div class=doc-container><div class=row><div class="col-xl-3 col-lg-4"><div class=doc-sidebar><div class="section-sm pb-5"><div class=doc-sidebar-title>目錄</div><ul class=list-unstyled><details open><summary>認識 Spring Boot</summary><ul class="list-unstyled list-nested"><li><a href=https://kucw.io/blog/springboot/1/>Day 1 - Spring Boot 簡介</a></li><li><a href=https://kucw.io/blog/springboot/2/>Day 2 - 開發環境安裝（Mac 版）</a></li><li><a href=https://kucw.io/blog/springboot/3/>Day 3 - 開發環境安裝（Windows 版）</a></li><li><a href=https://kucw.io/blog/springboot/4/>Day 4 - 第一個 Spring Boot 程式</a></li></ul></details><details open><summary>Spring IoC</summary><ul class="list-unstyled list-nested"><li><a href=https://kucw.io/blog/springboot/5/>Day 5 - Spring IoC 簡介</a></li><li><a href=https://kucw.io/blog/springboot/6/>Day 6 - IoC、DI、Bean 的介紹</a></li><li><a href=https://kucw.io/blog/springboot/7/>Day 7 - Bean 的創建和注入 - @Component、@Autowired</a></li><li><a href=https://kucw.io/blog/springboot/8/>Day 8 - 指定注入的 Bean - @Qualifier</a></li><li><a href=https://kucw.io/blog/springboot/9/>Day 9 - Bean 的初始化 - @PostConstruct</a></li><li><a href=https://kucw.io/blog/springboot/10/>Day 10 - 讀取 Spring Boot 設定檔 - @Value、application.properties</a></li></ul></details><details open><summary>Spring AOP</summary><ul class="list-unstyled list-nested"><li><a href=https://kucw.io/blog/springboot/11/>Day 11 - Spring AOP 簡介</a></li><li><a href=https://kucw.io/blog/springboot/12/>Day 12 - Spring AOP 的用法 - @Aspect</a></li></ul></details><details open><summary>Spring MVC</summary><ul class="list-unstyled list-nested"><li><a href=https://kucw.io/blog/springboot/13/>Day 13 - Spring MVC 簡介</a></li><li><a href=https://kucw.io/blog/springboot/14/>Day 14 - Http 協議介紹</a></li><li><a href=https://kucw.io/blog/springboot/15/>Day 15 - Url 路徑對應 - @RequestMapping</a></li><li><a href=https://kucw.io/blog/springboot/16/>Day 16 - 結構化的呈現數據 - JSON 格式介紹</a></li><li><a href=https://kucw.io/blog/springboot/17/>Day 17 - 返回值改成 JSON 格式 - @RestController</a></li><li><a href=https://kucw.io/blog/springboot/18/>Day 18 - 常見的 Http method - GET 和 POST</a></li><li><a href=https://kucw.io/blog/springboot/19/>Day 19 - 取得請求參數（上）- @RequestParam、@RequestBody</a></li><li><a href=https://kucw.io/blog/springboot/20/>Day 20 - 取得請求參數（下）- @RequestHeader、@PathVariable</a></li><li><a href=https://kucw.io/blog/springboot/21/>Day 21 - RESTful API 介紹</a></li><li><a href=https://kucw.io/blog/springboot/22/>Day 22 - RESTful API 實作 - @GetMapping、@PostMapping...</a></li><li><a href=https://kucw.io/blog/springboot/23/>Day 23 - Http Status Code（Http 狀態碼）介紹</a></li></ul></details><details open><summary>Spring JDBC</summary><ul class="list-unstyled list-nested"><li><a href=https://kucw.io/blog/springboot/24/>Day 24 - Spring JDBC 簡介</a></li><li><a href=https://kucw.io/blog/springboot/25/>Day 25 - 資料庫連線設定、IntelliJ 資料庫管理工具介紹</a></li><li><a href=https://kucw.io/blog/springboot/26/>Day 26 - Spring JDBC 的用法（上）- 執行 INSERT、UPDATE、DELETE SQL</a></li><li><a href=https://kucw.io/blog/springboot/27/>Day 27 - Spring JDBC 的用法（下）- 執行 SELECT SQL</a></li><li><a href=https://kucw.io/blog/springboot/28/>Day 28 - MVC 架構模式 - Controller-Service-Dao 三層式架構</a></li></ul></details><details open><summary>實戰演練</summary><ul class="list-unstyled list-nested"><li><a href=https://kucw.io/blog/springboot/29/ class=active>Day 29 - 實戰演練 - 打造一個簡單的圖書館系統</a></li><li><a href=https://kucw.io/blog/springboot/30/>Day 30 - Spring Boot 零基礎入門總結</a></li></ul></details></ul></div></div></div><div class="col-xl-7 col-lg-8"><div class="section-sm pb-5"><h1 class=doc-title>Day 29 - 實戰演練 - 打造一個簡單的圖書館系統</h1><div class=author-details><div><img src=https://kucw.io/images/author-sm.png alt class="author-thumb-blog rounded-circle"></div><div><p>古古</p><p>2024/07/29</p></div></div><hr class=doc-start-divider><div class="content mb-4"><p>哈囉大家好，我是古古。</p><p>在前面的文章中，我們有介紹了 Spring Boot 中的許多用法，包含 Spring IoC、Spring AOP、Spring MVC（和前端溝通）、以及 Spring JDBC（和資料庫溝通），並且我們也介紹了 MVC 架構模式的概念，以及 Controller-Service-Dao 三層式架構的實作。</p><p>所以接著的這篇文章，我們就會來做個實戰演練，總和前面所學習到的所有功能，練習實作一個圖書館的管理系統出來，所以我們就開始吧！</p><blockquote><p>補充：本文中所使用的完整程式碼會放在 GitHub 上 <a href=https://github.com/kucw/springboot-library target=_blank rel=noopener>springboot-library</a>，建議可以搭配觀看，學習效果更好。</p></blockquote><div class=markdown-toc><div class=markdown-toc-title>目錄</div><nav id=TableOfContents><ul><li><a href=#功能分析圖書館管理系統>功能分析：圖書館管理系統</a></li><li><a href=#資料庫-table-設計>資料庫 table 設計</a></li><li><a href=#1-實作查詢某一本書的功能>1. 實作「查詢某一本書」的功能</a><ul><li><a href=#bookcontrollercontroller-層的實作>BookController（Controller 層）的實作</a></li><li><a href=#bookserviceservice-層的實作>BookService（Service 層）的實作</a></li><li><a href=#bookdaodao-層的實作>BookDao（Dao 層）的實作</a></li><li><a href=#api-tester-實際測試>API Tester 實際測試</a></li><li><a href=#補充時間格式的設定>補充：時間格式的設定</a></li></ul></li><li><a href=#2-實作新增一本書的功能>2. 實作「新增一本書」的功能</a><ul><li><a href=#bookcontrollercontroller-層的實作-1>BookController（Controller 層）的實作</a></li><li><a href=#bookserviceservice-層的實作-1>BookService（Service 層）的實作</a></li><li><a href=#bookdaodao-層的實作-1>BookDao（Dao 層）的實作</a></li><li><a href=#api-tester-實際測試-1>API Tester 實際測試</a></li></ul></li><li><a href=#3-實作更新某一本書的功能>3. 實作「更新某一本書」的功能</a><ul><li><a href=#bookcontrollercontroller-層的實作-2>BookController（Controller 層）的實作</a></li><li><a href=#bookserviceservice-層的實作-2>BookService（Service 層）的實作</a></li><li><a href=#bookdaodao-層的實作-2>BookDao（Dao 層）的實作</a></li><li><a href=#api-tester-實際測試-2>API Tester 實際測試</a></li></ul></li><li><a href=#4-實作刪除某一本書的功>4. 實作「刪除某一本書」的功</a><ul><li><a href=#bookcontrollercontroller-層的實作-3>BookController（Controller 層）的實作</a></li><li><a href=#bookserviceservice-層的實作-3>BookService（Service 層）的實作</a></li><li><a href=#bookdaodao-層的實作-3>BookDao（Dao 層）的實作</a></li><li><a href=#api-tester-實際測試-3>API Tester 實際測試</a></li></ul></li><li><a href=#圖書館管理系統總結>圖書館管理系統總結</a></li><li><a href=#總結>總結</a></li></ul></nav></div><h2 id=功能分析圖書館管理系統 class=markdown-heading-anchor>功能分析：圖書館管理系統
<a href=#%e5%8a%9f%e8%83%bd%e5%88%86%e6%9e%90%e5%9c%96%e6%9b%b8%e9%a4%a8%e7%ae%a1%e7%90%86%e7%b3%bb%e7%b5%b1>#</a></h2><p>在我們開始動手寫程式去實作圖書館管理系統之前，首先可以先來分析一下，在這個圖書館的管理系統中，我們想要提供什麼樣的功能。</p><p>像是圖書館管理系統顧名思義，就是用來管理「書」的，所以我們針對「書」這個資源，就可以去實作他的 CRUD 四大基本操作，也就是「新增一本書」、「查詢某一本書」、「更新某本書的資訊」、「刪除某一本書」。</p><p>因此下面就會分別來介紹，要如何在 Spring Boot 中設計和實作出「書」的 CRUD 四個功能，完成一個簡易的圖書館管理系統。</p><h2 id=資料庫-table-設計 class=markdown-heading-anchor>資料庫 table 設計
<a href=#%e8%b3%87%e6%96%99%e5%ba%ab-table-%e8%a8%ad%e8%a8%88>#</a></h2><p>在設計資料庫 table 時，因為是針對「書本」這個資源來設計，因此我們可以設計一個 book table，去儲存書本的相關資訊。以下是創建 book table 的 SQL 語法：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#cf222e>CREATE</span><span style=color:#fff> </span><span style=color:#cf222e>TABLE</span><span style=color:#fff> </span>book<span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>(</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>book_id<span style=color:#fff>            </span><span style=color:#6639ba>INT</span><span style=color:#fff>          </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#fff> </span><span style=color:#cf222e>PRIMARY</span><span style=color:#fff> </span><span style=color:#cf222e>KEY</span><span style=color:#fff> </span>AUTO_INCREMENT<span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>title<span style=color:#fff>              </span><span style=color:#6639ba>VARCHAR</span><span style=color:#1f2328>(</span><span style=color:#0550ae>128</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>author<span style=color:#fff>             </span><span style=color:#6639ba>VARCHAR</span><span style=color:#1f2328>(</span><span style=color:#0550ae>32</span><span style=color:#1f2328>)</span><span style=color:#fff>  </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>image_url<span style=color:#fff>          </span><span style=color:#6639ba>VARCHAR</span><span style=color:#1f2328>(</span><span style=color:#0550ae>256</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>price<span style=color:#fff>              </span><span style=color:#6639ba>INT</span><span style=color:#fff>          </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>published_date<span style=color:#fff>     </span><span style=color:#cf222e>TIMESTAMP</span><span style=color:#fff>    </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>created_date<span style=color:#fff>       </span><span style=color:#cf222e>TIMESTAMP</span><span style=color:#fff>    </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>last_modified_date<span style=color:#fff> </span><span style=color:#cf222e>TIMESTAMP</span><span style=color:#fff>    </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span></code></pre></div><p>其中各個欄位的含義如下：</p><ul><li><p>book_id：表示 book 的唯一 id，由資料庫自動遞增</p></li><li><p>title：表示此書的書名</p></li><li><p>author：表示此書的作者</p></li><li><p>image_url：儲存此書的圖片連結</p></li><li><p>price：此書的販售價格</p><blockquote><p>補充：在實務上只要牽扯到「金錢」的部分，通常會用 BigDecimal 特別處理，不過由於此專案主要在練習 Spring Boot 的基礎結構和用法，因此此處使用 Integer 類型來簡化實作細節。</p></blockquote></li><li><p>published_date：此書的上架時間</p></li><li><p>created_date：創建這筆數據的時間</p></li><li><p>last_modified_date：最後修改這筆數據的時間</p></li></ul><p>而設計好資料庫 table 之後，就可以將這段 SQL 語法貼到 IntelliJ 中的 console 上，在 IntelliJ 中執行這個 SQL 語法，就可以在 myjdbc database 中創建 book table 出來。</p><p><img src=/images/blog/springboot/29/29-1.png alt loading=lazy data-zoomable width=3230 height=1742></p><p><img src=/images/blog/springboot/29/29-2.png alt loading=lazy data-zoomable width=3230 height=1742></p><h2 id=1-實作查詢某一本書的功能 class=markdown-heading-anchor>1. 實作「查詢某一本書」的功能
<a href=#1-%e5%af%a6%e4%bd%9c%e6%9f%a5%e8%a9%a2%e6%9f%90%e4%b8%80%e6%9c%ac%e6%9b%b8%e7%9a%84%e5%8a%9f%e8%83%bd>#</a></h2><p>創建好 book table 之後，接下來我們就可以開始來實作 Spring Boot 程式了！</p><p>通常在實作基礎的 CRUD 功能時，建議可以先從「查詢功能」開始實作，因此我們就先從「查詢一本書」這個功能開始實作。</p><h3 id=bookcontrollercontroller-層的實作 class=markdown-heading-anchor>BookController（Controller 層）的實作
<a href=#bookcontrollercontroller-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c>#</a></h3><p>首先我們可以先在 BookController 中，添加如下的程式：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#0550ae>@GetMapping</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;/books/{bookId}&#34;</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>public</span><span style=color:#fff> </span>ResponseEntity<span style=color:#0550ae>&lt;</span>Book<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span><span style=color:#6639ba>getBook</span><span style=color:#1f2328>(</span><span style=color:#0550ae>@PathVariable</span><span style=color:#fff> </span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Book<span style=color:#fff> </span>book<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>bookService<span style=color:#1f2328>.</span><span style=color:#1f2328>getBookById</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>book<span style=color:#fff> </span><span style=color:#0550ae>!=</span><span style=color:#fff> </span><span style=color:#cf222e>null</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>OK</span><span style=color:#1f2328>).</span><span style=color:#1f2328>body</span><span style=color:#1f2328>(</span>book<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>NOT_FOUND</span><span style=color:#1f2328>).</span><span style=color:#1f2328>build</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><blockquote><p>補充：由於程式的篇幅過長，因此本文中只會擷取部分重點來介紹，完整的程式碼可以前往 GitHub <a href=https://github.com/kucw/springboot-library target=_blank rel=noopener>springboot-library</a> 查看。</p></blockquote><p>在 BookController 中，因為他是屬於 Controller 層，所以他會使用 <code>@GetMapping</code>，去接住前端放在 url 路徑中的 bookId 的參數。</p><p>而在接到 bookId 的值之後，BookController 就會直接往後傳給 BookService 去做後續處理，即是將商業邏輯寫在 Service 層，讓 Controller 層保持「和前端溝通」的部分。</p><p>而當 BookService 返回查詢到的 book 數據之後，BookController 就可以根據「是否有查詢到數據與否」，去決定要返回給前端的 Http status code 為何。</p><p>像是在下面的程式中，<code>if</code> 區塊就呈現出「當 book 不為 null 時，就返回 200 OK 的 Http status code 給前端，並且把 book 數據放在 response body 中」的資訊。而在 <code>else</code> 區塊中，則是呈現「當 book 為 null 時，就返回 404 Not Found 的 Http status code 給前端」。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>book<span style=color:#fff> </span><span style=color:#0550ae>!=</span><span style=color:#fff> </span><span style=color:#cf222e>null</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>OK</span><span style=color:#1f2328>).</span><span style=color:#1f2328>body</span><span style=color:#1f2328>(</span>book<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>NOT_FOUND</span><span style=color:#1f2328>).</span><span style=color:#1f2328>build</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><blockquote><p>補充：如果不熟悉 Http status code 的話，可以回頭參考 <a href=/blog/springboot/23/ target=_blank rel=noopener>Day 23 - Http Status Code（Http 狀態碼）介紹</a> 的文章。</p></blockquote><h3 id=bookserviceservice-層的實作 class=markdown-heading-anchor>BookService（Service 層）的實作
<a href=#bookserviceservice-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c>#</a></h3><p>實作完 BookController 之後，接著我們往下實作 BookService。</p><p>當 BookService 收到 Controller 傳過來的 bookId 之後，因為這裡的邏輯比較簡單，沒有太複雜的商業邏輯要處理，因此 BookService 就只要直接去 call BookDao 的方法，交由 Dao 層去資料庫查詢數據即可。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span>Book<span style=color:#fff> </span><span style=color:#6639ba>getBookById</span><span style=color:#1f2328>(</span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>bookDao<span style=color:#1f2328>.</span><span style=color:#1f2328>getBookById</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><h3 id=bookdaodao-層的實作 class=markdown-heading-anchor>BookDao（Dao 層）的實作
<a href=#bookdaodao-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c>#</a></h3><p>而在 BookDao 這裡，因為他是 Dao 層，負責和「資料庫」溝通，因此就可以在這裡使用 Spring JDBC 的 <code>query()</code> 方法，在資料庫中執行 SELECT SQL，去查詢這一筆 bookId 的數據出來。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span>Book<span style=color:#fff> </span><span style=color:#6639ba>getBookById</span><span style=color:#1f2328>(</span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>String<span style=color:#fff> </span>sql<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;SELECT book_id, title, author, image_url, price, published_date, created_date, last_modified_date &#34;</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0a3069>&#34;FROM book WHERE book_id = :bookId&#34;</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Map<span style=color:#0550ae>&lt;</span>String<span style=color:#1f2328>,</span><span style=color:#fff> </span>Object<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>map<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>HashMap<span style=color:#0550ae>&lt;&gt;</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;bookId&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>List<span style=color:#0550ae>&lt;</span>Book<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>bookList<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>namedParameterJdbcTemplate<span style=color:#1f2328>.</span><span style=color:#1f2328>query</span><span style=color:#1f2328>(</span>sql<span style=color:#1f2328>,</span><span style=color:#fff> </span>map<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>BookRowMapper<span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>bookList<span style=color:#1f2328>.</span><span style=color:#1f2328>size</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>0<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>bookList<span style=color:#1f2328>.</span><span style=color:#1f2328>get</span><span style=color:#1f2328>(</span>0<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>return</span><span style=color:#fff> </span><span style=color:#cf222e>null</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>因此到這邊，「查詢某一本書」的功能就實作完畢了！</p><h3 id=api-tester-實際測試 class=markdown-heading-anchor>API Tester 實際測試
<a href=#api-tester-%e5%af%a6%e9%9a%9b%e6%b8%ac%e8%a9%a6>#</a></h3><p>因為目前 book table 中沒有任何數據，因此在測試「查詢某一本書」的功能之前，我們需要先在 IntelliJ 的 console 中執行下列的 SQL 語法，手動插入一筆數據到 book table 中。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#cf222e>INSERT</span><span style=color:#fff> </span><span style=color:#cf222e>INTO</span><span style=color:#fff> </span>book<span style=color:#fff> </span><span style=color:#1f2328>(</span>title<span style=color:#1f2328>,</span><span style=color:#fff> </span>author<span style=color:#1f2328>,</span><span style=color:#fff> </span>image_url<span style=color:#1f2328>,</span><span style=color:#fff> </span>price<span style=color:#1f2328>,</span><span style=color:#fff> </span>published_date<span style=color:#1f2328>,</span><span style=color:#fff> </span>created_date<span style=color:#1f2328>,</span><span style=color:#fff> </span>last_modified_date<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#cf222e>VALUES</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;先問，為什麼？：顛覆慣性思考的黃金圈理論，啟動你的感召領導力&#39;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#39;賽門‧西奈克&#39;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#39;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/092/65/0010926506.jpg&#39;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>331</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#39;2018-05-23 00:00:00&#39;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#39;2023-10-14 02:42:02&#39;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#39;2023-10-14 02:42:02&#39;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span></code></pre></div><p>插入這本書的數據之後，接著就可以在 API Tester 中，填上以下的參數設定，來測試「查詢某一本書」的功能：</p><p><img src=/images/blog/springboot/29/29-3.png alt loading=lazy data-zoomable width=2376 height=646></p><p>填寫完成之後，就可以按下 Send 鍵進行測試，結果如下：</p><p><img src=/images/blog/springboot/29/29-4.png alt loading=lazy data-zoomable width=2378 height=1073></p><h3 id=補充時間格式的設定 class=markdown-heading-anchor>補充：時間格式的設定
<a href=#%e8%a3%9c%e5%85%85%e6%99%82%e9%96%93%e6%a0%bc%e5%bc%8f%e7%9a%84%e8%a8%ad%e5%ae%9a>#</a></h3><p>這裡題外話補充一下，如果大家不是直接下載 GitHub 上的 <a href=https://github.com/kucw/springboot-library target=_blank rel=noopener>springboot-library</a> 程式來使用，而是靠自己自己一行一行輸入程式的話，那麼你在上圖中所返回的 publishedDate、createdDate、以及 lastModifiedDate 的值，就會是 <code>2018-05-22T16:00:00.000+00:00</code> 的格式，而不是上圖中的 <code>2018-05-23 00:00:00</code> 的格式。</p><p>之所以會有這個差異，是因為 Spring Boot 預設的時間格式為 <code>2018-05-22T16:00:00.000+00:00</code>，而要改變這個格式成 <code>2018-05-23 00:00:00</code> 的話，會需要在 application.properties 檔案中進行相關的設定。</p><p>因此就要麻煩大家，手動在 application.properties 檔案中添加下面這兩行程式，這樣子才能夠將 Spring Boot 的時間格式，改成是 <code>2018-05-23 00:00:00</code> 的樣子。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#1f2328>spring.jackson.time-zone</span><span style=color:#0550ae>=</span><span style=color:#0a3069>GMT+8</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>spring.jackson.date-format</span><span style=color:#0550ae>=</span><span style=color:#0a3069>yyyy-MM-dd HH:mm:ss</span>
</span></span></code></pre></div><p><img src=/images/blog/springboot/29/29-5.png alt loading=lazy data-zoomable width=3230 height=1742></p><h2 id=2-實作新增一本書的功能 class=markdown-heading-anchor>2. 實作「新增一本書」的功能
<a href=#2-%e5%af%a6%e4%bd%9c%e6%96%b0%e5%a2%9e%e4%b8%80%e6%9c%ac%e6%9b%b8%e7%9a%84%e5%8a%9f%e8%83%bd>#</a></h2><p>實作完「查詢某一本書」的功能之後，第二個推薦實作的，就是「新增一本書」的功能。</p><h3 id=bookcontrollercontroller-層的實作-1 class=markdown-heading-anchor>BookController（Controller 層）的實作
<a href=#bookcontrollercontroller-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-1>#</a></h3><p>首先我們一樣是可以先在 BookController 中，添加以下的程式，去接住前端所傳過來的參數：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#0550ae>@PostMapping</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;/books&#34;</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>public</span><span style=color:#fff> </span>ResponseEntity<span style=color:#0550ae>&lt;</span>Book<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span><span style=color:#6639ba>createBook</span><span style=color:#1f2328>(</span><span style=color:#0550ae>@RequestBody</span><span style=color:#fff> </span>BookRequest<span style=color:#fff> </span>bookRequest<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Integer<span style=color:#fff> </span>bookId<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>bookService<span style=color:#1f2328>.</span><span style=color:#1f2328>createBook</span><span style=color:#1f2328>(</span>bookRequest<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Book<span style=color:#fff> </span>book<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>bookService<span style=color:#1f2328>.</span><span style=color:#1f2328>getBookById</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>CREATED</span><span style=color:#1f2328>).</span><span style=color:#1f2328>body</span><span style=color:#1f2328>(</span>book<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>而在實作「新增一本書」時，通常會分成兩個步驟來實作：</p><ol><li>先去 call BookService 的 <code>createBook()</code> 方法，真的去資料庫中創建一筆 Book 數據出來</li><li>當資料庫創建好數據之後，重新查詢一次該筆 Book 數據，然後將這筆 Book 數據原封不動的回傳給前端</li></ol><p>首先第一步比較單純，就是在 BookController 接收到前端傳過來的 BookRequest 參數，接著將 BookRequest 往後傳遞給 BookService 去做處理。</p><p>範例的前端請求如下：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;title&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;原子習慣：細微改變帶來巨大成就的實證法則&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;author&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;詹姆斯‧克利爾&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;imageUrl&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/082/25/0010822522.jpg&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;price&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0550ae>260</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;publishedDate&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;2019-06-01 00:00:00&#34;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p><img src=/images/blog/springboot/29/29-6.png alt loading=lazy data-zoomable width=2378 height=1064></p><p>而第二步的實作與否，其實不會影響到「新增一本書」的具體功能（因為第二步只是查詢而已），因此可以看個人的喜好，決定是否要實作第二步。</p><h3 id=bookserviceservice-層的實作-1 class=markdown-heading-anchor>BookService（Service 層）的實作
<a href=#bookserviceservice-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-1>#</a></h3><p>在「新增一本書」的實作中，因為 BookService 的實作也是比較簡單，因此只要直接去 call BookDao 的方法，交由 Dao 層去資料庫中創建一筆數據就可以了。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span>Integer<span style=color:#fff> </span><span style=color:#6639ba>createBook</span><span style=color:#1f2328>(</span>BookRequest<span style=color:#fff> </span>bookRequest<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>bookDao<span style=color:#1f2328>.</span><span style=color:#1f2328>createBook</span><span style=color:#1f2328>(</span>bookRequest<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><h3 id=bookdaodao-層的實作-1 class=markdown-heading-anchor>BookDao（Dao 層）的實作
<a href=#bookdaodao-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-1>#</a></h3><p>而在 BookDao 裡面，因為他是 Dao 層，負責和「資料庫」溝通，因此就可以在這裡使用 Spring JDBC 的 <code>update()</code> 方法，在資料庫中執行 INSERT SQL，去新增一筆 Book 的數據。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span>Integer<span style=color:#fff> </span><span style=color:#6639ba>createBook</span><span style=color:#1f2328>(</span>BookRequest<span style=color:#fff> </span>bookRequest<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>String<span style=color:#fff> </span>sql<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;INSERT INTO book(title, author, image_url, price, published_date, created_date, last_modified_date) &#34;</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0a3069>&#34;VALUES (:title, :author, :imageUrl, :price, :publishedDate, :createdDate, :lastModifiedDate)&#34;</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Map<span style=color:#0550ae>&lt;</span>String<span style=color:#1f2328>,</span><span style=color:#fff> </span>Object<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>map<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>HashMap<span style=color:#0550ae>&lt;&gt;</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;title&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getTitle</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;author&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getAuthor</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;imageUrl&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getImageUrl</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;price&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getPrice</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;publishedDate&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getPublishedDate</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Date<span style=color:#fff> </span>now<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>Date<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;createdDate&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>now<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;lastModifiedDate&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>now<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>KeyHolder<span style=color:#fff> </span>keyHolder<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>GeneratedKeyHolder<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>namedParameterJdbcTemplate<span style=color:#1f2328>.</span><span style=color:#1f2328>update</span><span style=color:#1f2328>(</span>sql<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>MapSqlParameterSource<span style=color:#1f2328>(</span>map<span style=color:#1f2328>),</span><span style=color:#fff> </span>keyHolder<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>int</span><span style=color:#fff> </span>bookId<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>keyHolder<span style=color:#1f2328>.</span><span style=color:#1f2328>getKey</span><span style=color:#1f2328>().</span><span style=color:#1f2328>intValue</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>bookId<span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>這裡比較值得注意的是後面的 <code>KeyHolder</code> 的用法，他是在 <code>update()</code> 的一種進階的用法。</p><p><strong><code>KeyHolder</code> 的用途，是在創建一筆數據到資料庫時，取得「資料庫自動生成的 id 的值」。</strong></p><p>之所以要特別使用 <code>KeyHolder</code>，是因為我們前面在設計 book table 時，其中的 book_id 欄位，我們是設定成 <code>AUTO_INCREMENT</code>，而這就會導致一種現象，即是「我們在 Spring Boot 中插入了一筆數據，但是我們卻不知道這筆數據的 id 值是多少」。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>book_id<span style=color:#fff>  </span><span style=color:#6639ba>INT</span><span style=color:#fff> </span><span style=color:#cf222e>NOT</span><span style=color:#fff> </span><span style=color:#cf222e>NULL</span><span style=color:#fff> </span><span style=color:#cf222e>PRIMARY</span><span style=color:#fff> </span><span style=color:#cf222e>KEY</span><span style=color:#fff> </span>AUTO_INCREMENT<span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span></code></pre></div><p>因此 <code>KeyHolder</code> 就是為了解決這個問題而誕生的！</p><p>只要在執行 <code>update()</code> 方法時，同時也加入一個 <code>KeyHolder</code> 的參數，這樣子就可以在創建數據的同時，取得「資料庫自動生成的 id 的值」了（也就是取得 book_id 的值）。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>KeyHolder<span style=color:#fff> </span>keyHolder<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>GeneratedKeyHolder<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span>namedParameterJdbcTemplate<span style=color:#1f2328>.</span><span style=color:#1f2328>update</span><span style=color:#1f2328>(</span>sql<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>MapSqlParameterSource<span style=color:#1f2328>(</span>map<span style=color:#1f2328>),</span><span style=color:#fff> </span>keyHolder<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>int</span><span style=color:#fff> </span>bookId<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>keyHolder<span style=color:#1f2328>.</span><span style=color:#1f2328>getKey</span><span style=color:#1f2328>().</span><span style=color:#1f2328>intValue</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span></code></pre></div><p>所以到這邊，我們也完成了「新增一本書」的功能實作了！</p><h3 id=api-tester-實際測試-1 class=markdown-heading-anchor>API Tester 實際測試
<a href=#api-tester-%e5%af%a6%e9%9a%9b%e6%b8%ac%e8%a9%a6-1>#</a></h3><p>要測試「新增一本書」的功能的話，只需要在 API Tester 中，填上以下的參數設定：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;title&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;原子習慣：細微改變帶來巨大成就的實證法則&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;author&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;詹姆斯‧克利爾&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;imageUrl&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/082/25/0010822522.jpg&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;price&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0550ae>260</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;publishedDate&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;2019-06-01 00:00:00&#34;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p><img src=/images/blog/springboot/29/29-7.png alt loading=lazy data-zoomable width=2378 height=1064></p><p>填寫完成之後，就可以按下 Send 鍵進行測試，結果如下：</p><p><img src=/images/blog/springboot/29/29-8.png alt loading=lazy data-zoomable width=2378 height=1070></p><p>注意這裡有一個小細節，就是「返回的 Http status code 為 201，而不是普通的 200」。</p><p>201 表示的不僅是這一次的 Http 請求成功而已，他還額外表示「有一個新的資源成功的被創建了」的含義。也因為如此，201 很常被用在 POST 請求所返回的 Http status code 上。</p><blockquote><p>補充：有關 201 的詳細介紹，可以回頭參考 <a href=/blog/springboot/23/ target=_blank rel=noopener>Day 23 - Http Status Code（Http 狀態碼）介紹</a> 的文章。</p></blockquote><h2 id=3-實作更新某一本書的功能 class=markdown-heading-anchor>3. 實作「更新某一本書」的功能
<a href=#3-%e5%af%a6%e4%bd%9c%e6%9b%b4%e6%96%b0%e6%9f%90%e4%b8%80%e6%9c%ac%e6%9b%b8%e7%9a%84%e5%8a%9f%e8%83%bd>#</a></h2><p>實作完「新增一本書」的功能之後，接著我們往下實作「更新某一本書」的功能。</p><h3 id=bookcontrollercontroller-層的實作-2 class=markdown-heading-anchor>BookController（Controller 層）的實作
<a href=#bookcontrollercontroller-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-2>#</a></h3><p>首先我們一樣是可以先在 BookController 中，添加以下的程式，去接住前端所傳過來的參數：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#0550ae>@PutMapping</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;/books/{bookId}&#34;</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>public</span><span style=color:#fff> </span>ResponseEntity<span style=color:#0550ae>&lt;</span>Book<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span><span style=color:#6639ba>updateBook</span><span style=color:#1f2328>(</span><span style=color:#0550ae>@PathVariable</span><span style=color:#fff> </span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>,</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                                       </span><span style=color:#0550ae>@RequestBody</span><span style=color:#fff> </span>BookRequest<span style=color:#fff> </span>bookRequest<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#57606a>// 檢查 book 是否存在Book</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>book<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>bookService<span style=color:#1f2328>.</span><span style=color:#1f2328>getBookById</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>book<span style=color:#fff> </span><span style=color:#0550ae>==</span><span style=color:#fff> </span><span style=color:#cf222e>null</span><span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>NOT_FOUND</span><span style=color:#1f2328>).</span><span style=color:#1f2328>build</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#57606a>// 修改 Book 的數據</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>bookService<span style=color:#1f2328>.</span><span style=color:#1f2328>updateBook</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Book<span style=color:#fff> </span>updatedBook<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>bookService<span style=color:#1f2328>.</span><span style=color:#1f2328>getBookById</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>OK</span><span style=color:#1f2328>).</span><span style=color:#1f2328>body</span><span style=color:#1f2328>(</span>updatedBook<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>在實作「更新某一本書」的功能時，也是會分成兩個步驟來進行：</p><ol><li>先檢查此 Book 是否存在，如果不存在，就直接返回 404 Not Found 的錯誤給前端</li><li>如果此 Book 存在，則修改該 Book 的數據，並且返回修改後的 Book 數據給前端</li></ol><p>之所以會分成兩個步驟來執行，是因為透過這樣子的寫法，才能讓前端知道「他具體遇到的是什麼狀況」。</p><p>舉例來說，當前端拿到 404 的錯誤時，前端就知道可能是他的 bookId 參數寫錯，導致他嘗試去更新一個不存在的 Book，因此這時後前端就可以回頭去修改他的請求參數。而如果當前端拿到的是 200 成功，那就表示 Book 數據更新成功了。</p><p>假設我們不分成兩步驟來做，而是一拿到前端的 bookId 參數，就直接去更新該 bookId 的數據的話，雖然在資料庫的執行上不會出問題，但是對於前端來說，他卻會拿到 200 的成功回應，因此就會出現 <strong>「前端明明嘗試更新一筆不存在的數據，但是我們卻跟他說 OK 更新成功」</strong> 的奇怪情境，邏輯上並不是很合理。</p><p><strong>所以這裡在實作上，才會特別分成兩個步驟，先判斷 Book 是否存在，如果存在，才更新該 Book 的數據</strong>，透過這樣的實作，才能讓我們的後端程式更忠實的去呈現正確的邏輯。</p><h3 id=bookserviceservice-層的實作-2 class=markdown-heading-anchor>BookService（Service 層）的實作
<a href=#bookserviceservice-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-2>#</a></h3><p>在實作「更新某一本書」時，因為 BookService 的實作也是比較簡單，因此只要直接去 call BookDao 的方法，交由 Dao 層去修改資料庫中的數據即可。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span><span style=color:#cf222e>void</span><span style=color:#fff> </span><span style=color:#6639ba>updateBook</span><span style=color:#1f2328>(</span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>,</span><span style=color:#fff> </span>BookRequest<span style=color:#fff> </span>bookRequest<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>bookDao<span style=color:#1f2328>.</span><span style=color:#1f2328>updateBook</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><h3 id=bookdaodao-層的實作-2 class=markdown-heading-anchor>BookDao（Dao 層）的實作
<a href=#bookdaodao-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-2>#</a></h3><p>而在 BookDao 裡面，則可以使用 Spring JDBC 的 <code>update()</code> 方法，在資料庫中執行 UPDATE SQL，去更新這一筆 book 的數據。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span><span style=color:#cf222e>void</span><span style=color:#fff> </span><span style=color:#6639ba>updateBook</span><span style=color:#1f2328>(</span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>,</span><span style=color:#fff> </span>BookRequest<span style=color:#fff> </span>bookRequest<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>String<span style=color:#fff> </span>sql<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;UPDATE book SET title = :title, author = :author, image_url = :imageUrl, &#34;</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0a3069>&#34;price = :price, published_date = :publishedDate, last_modified_date = :lastModifiedDate&#34;</span><span style=color:#fff> </span><span style=color:#0550ae>+</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#0a3069>&#34; WHERE book_id = :bookId &#34;</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Map<span style=color:#0550ae>&lt;</span>String<span style=color:#1f2328>,</span><span style=color:#fff> </span>Object<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>map<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>HashMap<span style=color:#0550ae>&lt;&gt;</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;bookId&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;title&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getTitle</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;author&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getAuthor</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;imageUrl&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getImageUrl</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;price&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getPrice</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;publishedDate&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookRequest<span style=color:#1f2328>.</span><span style=color:#1f2328>getPublishedDate</span><span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;lastModifiedDate&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>Date<span style=color:#1f2328>());</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>namedParameterJdbcTemplate<span style=color:#1f2328>.</span><span style=color:#1f2328>update</span><span style=color:#1f2328>(</span>sql<span style=color:#1f2328>,</span><span style=color:#fff> </span>map<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>這裡在實作上需要注意一個細節，即是在更新數據時，要記得也去更新 book table 中的 <code>last_modified_date</code> 欄位的值，將他更新成當前的時間。</p><p>之所以要特別更新 <code>last_modified_date</code> 的時間，是因為 <code>last_modified_date</code> 的含義是「最後修改此筆數據的時間」，因此其他人就可以透過這個欄位，知道這筆數據最後是在什麼時候被修改過。</p><p>因此當我們對 book table 中的數據進行更新時，就要記得同時也去更新 <code>last_modified_date</code> 的值，確保「最後更新時間」的值有一起被修改成當前時間。</p><p>所以到這邊，我們就完成了「更新某一本書」的功能實作了！</p><h3 id=api-tester-實際測試-2 class=markdown-heading-anchor>API Tester 實際測試
<a href=#api-tester-%e5%af%a6%e9%9a%9b%e6%b8%ac%e8%a9%a6-2>#</a></h3><p>假設我們要更新 id 為 2 的那本書，那麼就只需要在 API Tester 中，填上以下的參數設定：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;title&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;Atomic Habits: An Easy &amp; Proven Way to Build Good Habits &amp; Break Bad Ones&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;author&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;James Clear&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;imageUrl&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/082/25/0010822522.jpg&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;price&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0550ae>1000000</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;publishedDate&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;2019-06-01 00:00:00&#34;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p><img src=/images/blog/springboot/29/29-9.png alt loading=lazy data-zoomable width=2371 height=1062></p><p>填寫完成之後，就可以按下 Send 鍵進行測試，結果如下：</p><p><img src=/images/blog/springboot/29/29-10.png alt loading=lazy data-zoomable width=2379 height=1071></p><h2 id=4-實作刪除某一本書的功 class=markdown-heading-anchor>4. 實作「刪除某一本書」的功
<a href=#4-%e5%af%a6%e4%bd%9c%e5%88%aa%e9%99%a4%e6%9f%90%e4%b8%80%e6%9c%ac%e6%9b%b8%e7%9a%84%e5%8a%9f>#</a></h2><p>實作完上述的功能之後，最後我們可以來實作「刪除某一本書」的功能。</p><h3 id=bookcontrollercontroller-層的實作-3 class=markdown-heading-anchor>BookController（Controller 層）的實作
<a href=#bookcontrollercontroller-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-3>#</a></h3><p>首先我們一樣是可以先在 BookController 中，添加以下的程式，去接住前端所傳過來的參數：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#0550ae>@DeleteMapping</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;/books/{bookId}&#34;</span><span style=color:#1f2328>)</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#cf222e>public</span><span style=color:#fff> </span>ResponseEntity<span style=color:#0550ae>&lt;?&gt;</span><span style=color:#fff> </span>deleteBook<span style=color:#1f2328>(</span><span style=color:#0550ae>@PathVariable</span><span style=color:#fff> </span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>bookService<span style=color:#1f2328>.</span><span style=color:#1f2328>deleteBookById</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>ResponseEntity<span style=color:#1f2328>.</span><span style=color:#1f2328>status</span><span style=color:#1f2328>(</span>HttpStatus<span style=color:#1f2328>.</span><span style=color:#1f2328>NO_CONTENT</span><span style=color:#1f2328>).</span><span style=color:#1f2328>build</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>在實作「刪除某一本書」的功能時，他的設計理念，會和上面的「更新某一本書」有點不一樣。</p><p>在上面的「更新某一本書」中，我們會先去檢查該書是否存在，然後再根據該書是否存在，去返回不同的 Http status code 給前端。<strong>但是在實作「刪除某一本書」時，不管這本書存不存在，我們就只要通通回傳「成功的 204 No Content」的 Http status code 給前端即可。</strong></p><p>之所以會有這樣子的差異，是因為在「刪除某一本書」的觀念裡，他的目的就是「要去刪除那一本書」，所以換句話說的話，就是「要讓那本書的數據從地球上消失」就對了，因此這時會有兩種情況：</p><ul><li>假設這本書存在，那麼我們就刪除他，所以這本書的數據就不存在了，完美！因此就回傳 204 No Content 給前端</li><li>假設這本書不存在，那麼即使我們沒有執行刪除的動作，這本書的數據本身也是不存在的，所以同樣也是回傳 204 No Content 給前端</li></ul><p><strong>所以對於「刪除某一本書」的功能來說，他在意的「不是」有沒有真的刪除到數據，他在意的是「該數據是否真的消失了」。</strong> 只要數據消失，不管他是曾經出現過然後被刪除、或是從來就沒出現過，對於「刪除某一本書」這個功能來說，就通通都是回傳成功的 204 No Content 就對了！</p><h3 id=bookserviceservice-層的實作-3 class=markdown-heading-anchor>BookService（Service 層）的實作
<a href=#bookserviceservice-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-3>#</a></h3><p>在「刪除某一本書」的功能中，因為 BookService 的實作也是比較簡單，因此只要直接去 call BookDao 的方法，交由 Dao 層去刪除資料庫中的數據即可。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span><span style=color:#cf222e>void</span><span style=color:#fff> </span><span style=color:#6639ba>deleteBookById</span><span style=color:#1f2328>(</span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>bookDao<span style=color:#1f2328>.</span><span style=color:#1f2328>deleteBookById</span><span style=color:#1f2328>(</span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><h3 id=bookdaodao-層的實作-3 class=markdown-heading-anchor>BookDao（Dao 層）的實作
<a href=#bookdaodao-%e5%b1%a4%e7%9a%84%e5%af%a6%e4%bd%9c-3>#</a></h3><p>而在 BookDao 裡面，則是可以使用 Spring JDBC 的 <code>update()</code> 方法，在資料庫中執行 DELETE SQL，去刪除這一筆 book 的數據。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span><span style=color:#cf222e>void</span><span style=color:#fff> </span><span style=color:#6639ba>deleteBookById</span><span style=color:#1f2328>(</span>Integer<span style=color:#fff> </span>bookId<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>String<span style=color:#fff> </span>sql<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;DELETE FROM book WHERE book_id = :bookId &#34;</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>Map<span style=color:#0550ae>&lt;</span>String<span style=color:#1f2328>,</span><span style=color:#fff> </span>Object<span style=color:#0550ae>&gt;</span><span style=color:#fff> </span>map<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>HashMap<span style=color:#0550ae>&lt;&gt;</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>map<span style=color:#1f2328>.</span><span style=color:#1f2328>put</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;bookId&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>bookId<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span>namedParameterJdbcTemplate<span style=color:#1f2328>.</span><span style=color:#1f2328>update</span><span style=color:#1f2328>(</span>sql<span style=color:#1f2328>,</span><span style=color:#fff> </span>map<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff></span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p>所以到這邊，我們就完成了「刪除某一本書」的功能實作了！</p><h3 id=api-tester-實際測試-3 class=markdown-heading-anchor>API Tester 實際測試
<a href=#api-tester-%e5%af%a6%e9%9a%9b%e6%b8%ac%e8%a9%a6-3>#</a></h3><p>假設我們要刪除 id 為 1 的那本書，那麼就只需要在 API Tester 中，填上以下的參數設定：</p><p><img src=/images/blog/springboot/29/29-11.png alt loading=lazy data-zoomable width=2377 height=648></p><p>填寫完成之後，就可以按下 Send 鍵進行測試，結果如下：</p><p><img src=/images/blog/springboot/29/29-12.png alt loading=lazy data-zoomable width=2376 height=742></p><h2 id=圖書館管理系統總結 class=markdown-heading-anchor>圖書館管理系統總結
<a href=#%e5%9c%96%e6%9b%b8%e9%a4%a8%e7%ae%a1%e7%90%86%e7%b3%bb%e7%b5%b1%e7%b8%bd%e7%b5%90>#</a></h2><p>在實作完上述的四個功能之後，我們就完成了針對「書本」這個資源的 CRUD 實作了！所以在上面的實作中，我們完成了以下四個功能：</p><ul><li>新增一本書（Create）</li><li>查詢某一本書（Read）</li><li>更新某一本書的資訊（Update）</li><li>刪除某一本書（Delete）</li></ul><p>因此對於管理員來說，就可以透過這個後端系統，在資料庫中去新增、刪除、查詢、和修改裡面的書本了！</p><p>不過，對於一個圖書館管理系統來說，其實單單只有 CRUD 的功能，是沒辦法滿足所有需求的。</p><p>像是管理員可能需要「查詢書本列表」的功能，要能夠根據出版時間、價格、名字&mldr;等等的因素，去列出符合條件的書本有哪些。</p><p>又或者是管理員可能想要「權限管理」的功能，只讓正職員工擁有「新增、修改、刪除」書本的功能，而讓實習生只有「查詢」書本的功能，避免實習生誤操作，使得資料庫中的書本資料被刪除。</p><p>因此針對一個圖書館管理系統，背後還是有許多功能可以延伸的！不過這些強大的功能，都是建立在 CRUD 功能已經完成的前提下，才有辦法往下延伸。</p><p>所以大家在剛入門 Spring Boot 時，建議一定要打好 CRUD 的基礎，只有當你能夠獨當一面實作出 CRUD 的功能時，才算是具備後端工程師的基本實作能力。</p><blockquote><p>補充：雖然大家在實作 CRUD 時可能會覺得很重複很無聊，但還是建議大家要好好打下這邊的基礎，練好 CRUD 的基本功，這樣後續不管是要繼續去學習 Spring Boot 的進階功能，還是延伸去學習 Spring Security&mldr;等框架，才能更好上手。</p></blockquote><h2 id=總結 class=markdown-heading-anchor>總結
<a href=#%e7%b8%bd%e7%b5%90>#</a></h2><p>這篇文章我們先分析了「圖書館管理系統」需要實作哪些功能，並且針對「書本」這個資源，去設計了 CRUD 的四大基本操作，同時我們也有實際到 Spring Boot 中，練習去實作出 CRUD 的四個功能出來。</p><p>那麼有關 Spring Boot 的基礎入門介紹，到這邊就告一個段落了，因此下一篇文章我們就會來總結一下，在這 30 篇文章中我們都介紹了哪些知識，來做一個大總結，那我們就下一篇文章見啦！</p><blockquote><p>補充：本文是擷取自我開設的線上課程 <a href=https://hahow.in/cr/springboot target=_blank rel=noopener>Java 工程師必備！Spring Boot 零基礎入門</a> 的內容，如果你想了解更多的 Spring Boot 的用法，歡迎參考課程簡介 <strong>（輸入折扣碼「HH202506KU」即可享 85 折優惠）。</strong></p></blockquote></div><div class=doc-newsletter><h4>免費訂閱《古古的後端筆記》電子報（長期休刊中）</h4><div><p>每週二學習後端技術，和 3500 人一起變強💪</p><div id=doc-newsletter class=newsletter><div class="row justify-content-center"><div class=col-md-8><div class=success>已發送 Email 驗證信！請前往信箱驗證你的訂閱</div><div class=error>訂閱失敗，請檢查 Email 是否輸入錯誤，或是聯繫 service@kucw.io 取得協助</div><div class=maintenance>電子報伺服器正在維護中，請稍後再試</div></div></div><form action=# method=POST class="row justify-content-center"><div class="input-group col-md-8"><input type=email required name=email class=form-control placeholder="輸入你的 Email"><div class=input-group-append><button type=submit class="input-group-text btn btn-primary">
免費訂閱</button></div></div></form></div></div></div></div><div class=row><div class="col-sm-6 p-2"><a href=/blog/springboot/28/><div class=doc-previous-page><div class=doc-previous-pager-indicator><i class=ti-arrow-left></i>上一頁</div><div class=doc-pager-title>Day 28 - MVC 架構模式 - Controller-Service-Dao 三層式架構</div></div></a></div><div class="col-sm-6 p-2"><a href=/blog/springboot/30/><div class=doc-next-page><div class=doc-next-pager-indicator>下一頁<i class=ti-arrow-right></i></div><div class=doc-pager-title>Day 30 - Spring Boot 零基礎入門總結</div></div></a></div></div></div><div class=col-xl-2><div class="doc-right-sidebar pb-5"></div></div></div></div><footer><div class=container><div class="row justify-content-center pb-4"><div class="col-12 text-center mb-5"><a href=https://kucw.io/><img class="img-fluid logo-thumb-md rounded-circle mx-1" src=https://kucw.io/images/logo.png alt=古古的後端筆記></a></div></div><div class="row pb-1"><div class="col-lg-8 text-center pb-5"><h4>免費訂閱電子報，每週二學習後端技術🚀<br>（長期休刊中）</h4><div id=footer-newsletter class=newsletter><div class="row justify-content-center"><div class=col-md-8><div class=success>已發送 Email 驗證信！請前往信箱驗證你的訂閱</div><div class=error>訂閱失敗，請檢查 Email 是否輸入錯誤，或是聯繫 service@kucw.io 取得協助</div><div class=maintenance>電子報伺服器正在維護中，請稍後再試</div></div></div><form action=# method=POST class="row justify-content-center"><div class="input-group col-md-8"><input type=email required name=email class=form-control placeholder="輸入你的 Email"><div class=input-group-append><button type=submit class="input-group-text btn btn-primary">
免費訂閱</button></div></div></form></div></div><div class="col-lg-4 pb-3 footer-contact-me"><h5 class=mb-4>追蹤古古</h5><ul class="list-inline footer-social-links"><li class=list-inline-item><a href=https://github.com/kucw target=_blank rel=noopener><i class=ti-github></i></a></li><li class=list-inline-item><a href=https://www.facebook.com/kucw.io target=_blank rel=noopener><i class=ti-facebook></i></a></li><li class=list-inline-item><a href=https://www.instagram.com/kucw.io/ target=_blank rel=noopener><i class=ti-instagram></i></a></li></ul><p>聯絡信箱: service@kucw.io</p></div></div><div class="border-top py-4 text-center">© 2020-2025 古古的後端筆記 | All Rights Reserved.</div></div></div></footer><script>var indexURL="https://kucw.io/index.json"</script><script src=https://kucw.io/plugins/jQuery/jquery.min.js></script><script src=https://kucw.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://kucw.io/plugins/mailbluster/mailbluster.js></script><script src=https://kucw.io/plugins/confetti/confetti.browser.min.js></script><script src=https://kucw.io/plugins/confetti/welcomeConfetti.js></script><script src=https://kucw.io/plugins/medium-zoom/medium-zoom.min.js></script><script src=https://kucw.io/plugins/algolia-search/algoliasearch.js></script><script src=https://kucw.io/plugins/algolia-search/algoliasearch-lite.umd.js></script><script src=https://kucw.io/plugins/algolia-search/instantsearch.production.min.js></script><script src=https://kucw.io/plugins/clipboard/clipboard.min.js></script><script src=https://kucw.io/plugins/clipboard/code-clipboard.js></script><script src=https://kucw.io/plugins/login/login.js></script><script src=https://kucw.io/js/script.min.aa7e377695025ea8426da51bc7ddbc5d24fa31916deb7d8d442296c493598de4.js></script></body></html>